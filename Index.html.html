<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GoldTradeX Journal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #111;
      color: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .app {
      width: min(900px, 100vw - 20px);
      height: min(620px, 100vh - 20px);
      background: #181818;
      border-radius: 18px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
      padding: 14px;
      display: flex;
      flex-direction: column;
      border: 1px solid #333;
    }

    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 6px;
      border-bottom: 1px solid #333;
    }

    .brand {
      font-weight: 700;
      letter-spacing: 0.08em;
      color: #f5c542;
      font-size: 0.9rem;
      text-transform: uppercase;
    }

    .page-info { font-size: 0.9rem; opacity: 0.8; }
    .controls { display: flex; gap: 6px; }

    button {
      border: none;
      border-radius: 999px;
      padding: 6px 12px;
      background: #262626;
      color: #f5f5f5;
      cursor: pointer;
      font-size: 0.85rem;
    }
    button:hover { background: #333; }
    button.primary { background: #f5c542; color: #111; font-weight: 600; }
    button.primary:hover { background: #ffd45f; }
    button:disabled { opacity: 0.4; cursor: default; }

    .book {
      flex: 1;
      margin-top: 4px;
      background: #111;
      border-radius: 14px;
      padding: 12px;
      display: grid;
      grid-template-columns: 120px 1fr;
      gap: 10px;
    }

    .sidebar {
      border-right: 1px solid #262626;
      padding-right: 8px;
      display: flex;
      flex-direction: column;
    }

    .sidebar-title {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #888;
      margin-bottom: 6px;
    }

    .page-list { flex: 1; overflow-y: auto; }

    .page-item {
      font-size: 0.8rem;
      padding: 4px 6px;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 3px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .page-item span { opacity: 0.9; }
    .page-item small { opacity: 0.6; font-size: 0.7rem; }
    .page-item.active { background: #f5c542; color: #111; font-weight: 600; }
    .page-item:hover:not(.active) { background: #222; }

    .page {
      display: flex;
      flex-direction: column;
      gap: 6px;
      height: 100%;
    }

    .row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      font-size: 0.8rem;
      color: #bbb;
    }

    .field {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .field label {
      opacity: 0.8;
      font-size: 0.78rem;
    }

    .field input {
      background: transparent;
      border: none;
      border-bottom: 1px solid #333;
      color: #f5f5f5;
      padding: 2px 4px;
      font-size: 0.85rem;
      min-width: 70px;
    }
    .field input:focus {
      outline: none;
      border-color: #f5c542;
    }

    textarea {
      width: 100%;
      resize: none;
      padding: 8px 10px;
      border-radius: 10px;
      background: linear-gradient(#222 1px, transparent 1px) repeat-y;
      background-size: 100% 22px;
      background-color: #121212;
      color: #f5f5f5;
      font-size: 0.86rem;
      line-height: 22px;
      font-family: monospace;
      border: none;
      outline: none;
    }

    .notes-wrapper {
      display: grid;
      grid-template-columns: minmax(0,1.3fr) minmax(0,1fr);
      gap: 6px;
      flex: 1;
      min-height: 0;
    }

    .section-title {
      font-size: 0.74rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.65;
      margin: 4px 0;
    }

    .chart-box {
      background: #121212;
      border-radius: 10px;
      padding: 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .chart-input, .chart-file {
      width: 100%;
      background: #181818;
      border-radius: 6px;
      border: 1px solid #333;
      color: #eee;
      font-size: 0.78rem;
      padding: 4px 6px;
    }

    .chart-input:focus {
      outline: none;
      border-color: #f5c542;
    }

    .chart-preview {
      flex: 1;
      border-radius: 8px;
      overflow: hidden;
      border: 1px dashed #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      color: #777;
      background: #0c0c0c;
    }

    .chart-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .footer {
      margin-top: 6px;
      font-size: 0.7rem;
      text-align: right;
      opacity: 0.6;
    }

    @media (max-width: 820px) {
      .notes-wrapper { grid-template-columns: 1fr; }
    }

    @media (max-width: 700px) {
      .book {
        grid-template-columns: 1fr;
      }
      .sidebar {
        flex-direction: row;
        border-right: none;
        border-bottom: 1px solid #262626;
        padding-right: 0;
        padding-bottom: 6px;
        overflow-x: auto;
      }
      .page-list {
        display: flex;
        flex-direction: row;
        gap: 4px;
      }
      .page-item { white-space: nowrap; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="app-header">
      <div>
        <div class="brand">GOLDTRADEX JOURNAL</div>
        <div class="page-info" id="pageInfo">Page 1 of 1</div>
      </div>
      <div class="controls">
        <button id="prevBtn">◀ Prev</button>
        <button id="nextBtn">Next ▶</button>
        <button class="primary" id="addPageBtn">+ New Page</button>
      </div>
    </div>

    <div class="book">
      <div class="sidebar">
        <div class="sidebar-title">Pages</div>
        <div class="page-list" id="pageList"></div>
      </div>

      <div class="page">
        <div class="row">
          <div class="field">
            <label>Date:</label>
            <input id="dateInput" placeholder="YYYY-MM-DD">
          </div>
          <div class="field">
            <label>Pair:</label>
            <input id="pairInput" placeholder="XAUUSD">
          </div>
          <div class="field">
            <label>Session:</label>
            <input id="sessionInput" placeholder="London / NY">
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Entry:</label>
            <input id="entryInput" placeholder="4050.00">
          </div>
          <div class="field">
            <label>SL:</label>
            <input id="slInput" placeholder="4044.00">
          </div>
          <div class="field">
            <label>Exit:</label>
            <input id="exitInput" placeholder="4065.00">
          </div>
          <div class="field">
            <label>R:R:</label>
            <input id="rrInput" placeholder="1:4" readonly>
          </div>
        </div>

        <div class="notes-wrapper">
          <div class="notes-left">
            <div class="section-title">Setup & Execution Notes</div>
            <textarea id="pageContent"
              placeholder="1) Setup (liquidity sweep, CHOCH, BOS)...&#10;2) Entry trigger & confirmation...&#10;3) Management rules (BE, partials)..."></textarea>

            <div class="section-title">Emotions & Post-Trade Review</div>
            <textarea id="reviewContent"
              placeholder="Yahan likho trade ke time kya feel hua, discipline follow hua ya nahi, next time kya improve karna hai..."></textarea>
          </div>

          <div class="chart-box">
            <div>
              <div class="section-title">Chart Image</div>
              <input
                id="chartUrlInput"
                class="chart-input"
                placeholder="(OPTIONAL) Online chart image URL yahan paste karo (https://...)"/>
            </div>
            <div>
              <input
                id="chartFileInput"
                class="chart-file"
                type="file"
                accept="image/*" />
            </div>
            <div class="chart-preview" id="chartPreview">
              <span>Chart nahi hai abhi – ya to upar URL paste karo, ya neeche se file choose karo.</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      Risk small. Think clear. Execute instantly. – GoldTradeX ⚡</div>
  </div>

  <script>
    const STORAGE_KEY = "goldtradex_journal_v3";

    let pages = [];
    let currentPage = 0;

    const dateInput      = document.getElementById("dateInput");
    const pairInput      = document.getElementById("pairInput");
    const sessionInput   = document.getElementById("sessionInput");
    const entryInput     = document.getElementById("entryInput");
    const slInput        = document.getElementById("slInput");
    const exitInput      = document.getElementById("exitInput");
    const rrInput        = document.getElementById("rrInput");
    const pageContent    = document.getElementById("pageContent");
    const reviewContent  = document.getElementById("reviewContent");
    const chartUrlInput  = document.getElementById("chartUrlInput");
    const chartFileInput = document.getElementById("chartFileInput");
    const chartPreview   = document.getElementById("chartPreview");
    const pageList       = document.getElementById("pageList");
    const pageInfo       = document.getElementById("pageInfo");
    const prevBtn        = document.getElementById("prevBtn");
    const nextBtn        = document.getElementById("nextBtn");
    const addPageBtn     = document.getElementById("addPageBtn");

    function blankPage() {
      return {
        date: new Date().toISOString().slice(0,10),
        pair: "",
        session: "",
        entry: "",
        sl: "",
        exit: "",
        rr: "",
        content: "",
        review: "",
        chartUrl: ""   // yahan data URL ya https URL dono aa sakta hai
      };
    }

    function loadPages() {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        try {
          pages = JSON.parse(stored);
        } catch {
          pages = [];
        }
      }
      if (pages.length === 0) {
        pages.push(blankPage());
      }
    }

    function savePages() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(pages));
    }

    function updateRR() {
      const e = parseFloat(entryInput.value);
      const s = parseFloat(slInput.value);
      const x = parseFloat(exitInput.value);

      if (!isNaN(e) && !isNaN(s) && !isNaN(x) && e !== s) {
        const risk = Math.abs(e - s);
        const reward = Math.abs(x - e);
        if (risk > 0) {
          const rrVal = reward / risk;
          rrInput.value = "1:" + Math.round(rrVal);

        }
      }
    }

    function renderChartPreview() {
      const url = pages[currentPage].chartUrl;
      if (!url) {
        chartPreview.innerHTML = "<span>Chart nahi hai abhi – URL paste karo ya file select karo.</span>";
        return;
      }
      chartPreview.innerHTML = "";
      const img = document.createElement("img");
      img.src = url;
      img.alt = "Chart Preview";
      img.onerror = () => {
        chartPreview.innerHTML = "<span>Image load nahi ho paayi. URL/file check karo.</span>";
      };
      chartPreview.appendChild(img);
    }

    function renderSidebar() {
      pageList.innerHTML = "";
      pages.forEach((p, idx) => {
        const item = document.createElement("div");
        item.className = "page-item" + (idx === currentPage ? " active" : "");
        const title = p.pair || `Page ${idx + 1}`;
        item.innerHTML = `<span>${idx + 1}. ${title}</span><small>${p.date || ""}</small>`;
        item.onclick = () => {
          goToPage(idx);
        };
        pageList.appendChild(item);
      });

      pageInfo.textContent = `Page ${currentPage + 1} of ${pages.length}`;
      prevBtn.disabled = currentPage === 0;
      nextBtn.disabled = currentPage === pages.length - 1;
    }

    function renderCurrentPage() {
      const p = pages[currentPage];
      dateInput.value     = p.date || "";
      pairInput.value     = p.pair || "";
      sessionInput.value  = p.session || "";
      entryInput.value    = p.entry || "";
      slInput.value       = p.sl || "";
      exitInput.value     = p.exit || "";
      rrInput.value       = p.rr || "";
      pageContent.value   = p.content || "";
      reviewContent.value = p.review || "";
      chartUrlInput.value = p.chartUrl && p.chartUrl.startsWith("http") ? p.chartUrl : "";

      renderSidebar();
      renderChartPreview();
    }

    function saveCurrentPageState() {
      const p = pages[currentPage];
      p.date    = dateInput.value;
      p.pair    = pairInput.value;
      p.session = sessionInput.value;
      p.entry   = entryInput.value;
      p.sl      = slInput.value;
      p.exit    = exitInput.value;
      updateRR();
      p.rr      = rrInput.value;
      p.content = pageContent.value;
      p.review  = reviewContent.value;

      // Agar user ne URL manually likha hai
      const url = chartUrlInput.value.trim();
      if (url) {
        p.chartUrl = url; // Ye https/online link hoga
      }

      savePages();
      renderSidebar();
      renderChartPreview();
    }

    function goToPage(idx) {
      if (idx < 0 || idx >= pages.length) return;
      saveCurrentPageState();
      currentPage = idx;
      renderCurrentPage();
    }

    function addPage() {
      saveCurrentPageState();
      pages.push(blankPage());
      currentPage = pages.length - 1;
      savePages();
      renderCurrentPage();
    }

    // Event listeners
    [
      dateInput, pairInput, sessionInput,
      entryInput, slInput, exitInput,
      pageContent, reviewContent, chartUrlInput
    ].forEach(el => {
      el.addEventListener("input", () => {
        saveCurrentPageState();
      });
    });

    chartFileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        // ye data URL hoga (browser ke andar hi safe)
        pages[currentPage].chartUrl = reader.result;
        savePages();
        renderChartPreview();
      };
      reader.readAsDataURL(file);
    });

    prevBtn.onclick = () => goToPage(currentPage - 1);
    nextBtn.onclick = () => goToPage(currentPage + 1);
    addPageBtn.onclick = addPage;

    // Init
    loadPages();
    renderCurrentPage();
  </script>
</body>
</html>
